var Rsync = require('../rsync');

// Build the base command
var cmd = new Rsync()
    .flags('avz')
    .shell('ssh')
    .progress()
    .dry()
    .source('b/*')
    .destination('out/');

var output = '';
var errorOutput = '';

// Register output handlers
cmd.output(function(data) {
  // stdout data
  console.log(data.toString());
}, function(data) {
  // stderr data
  errorOutput += data.toString();
});

cmd.execute(function(error, code, cmd) {
  if (error) {
    console.log('Something went wrong: ' + error.message);
    // Parse the error output
    var message = errorOutput.match(new RegExp('rsync error: .*', 'i'));
    console.log('rsync message: ' + message);
  }

});
